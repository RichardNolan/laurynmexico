<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <canvas id="myCanvas" width="400" height="527" style="border: 1px solid black"></canvas>
    <div style="width: 300px; height: 300" id="selected-color"></div>
    <script>
      var canvas = document.getElementById("myCanvas");
      var ctx = canvas.getContext("2d");

      var img = new Image();
      img.src = "./skull.png";
      img.onload = function () {
        ctx.drawImage(img, 0, 0, 400, 527);
        img.style.display = "none";
      };

      const compare = (_o, _p, f = 25) => {
        return (
          _p.data[0] >= _o.data[0] - f &&
          _p.data[0] <= _o.data[0] + f &&
          _p.data[1] === _o.data[1] &&
          _p.data[1] <= _o.data[1] + f &&
          _p.data[2] === _o.data[2] &&
          _p.data[2] <= _o.data[2] + f
        );
      };
      const color = (p, c = [255, 0, 0, 255]) => {
        p.data[0] = c[0];
        p.data[1] = c[1];
        p.data[2] = c[2];
        p.data[3] = c[3];
      };
      function pick(event) {
        var clickX = event.layerX;
        var clickY = event.layerY;
        var originalPixel = ctx.getImageData(clickX, clickY, 1, 1);
        console.log(clickX, clickY);
        console.log("originalPixel", originalPixel);

        for (let x = clickX - 1; x > 0; x--) {
          const pixel = ctx.getImageData(x, clickY, 1, 1);

          if (compare(originalPixel, pixel)) {
            color(pixel);
            ctx.putImageData(pixel, x, clickY);

            for (let y = clickY - 1; y > 0; y--) {
              const pixel = ctx.getImageData(x, y, 1, 1);
              if (compare(originalPixel, pixel)) {
                color(pixel);
                ctx.putImageData(pixel, x, y);
              } else {
                y = 0;
              }
            }
            for (let y = clickY + 1; y < 600; y++) {
              const pixel = ctx.getImageData(x, y, 1, 1);
              if (compare(originalPixel, pixel)) {
                color(pixel);
                ctx.putImageData(pixel, x, y);
              } else {
                y = 600;
              }
            }
          } else {
            x = 0;
          }
        }
        for (let x = clickX; x < 400; x++) {
          const pixel = ctx.getImageData(x, clickY, 1, 1);
          if (compare(originalPixel, pixel)) {
            color(pixel);
            ctx.putImageData(pixel, x, clickY);

            for (let y = clickY - 1; y > 0; y--) {
              const pixel = ctx.getImageData(x, y, 1, 1);
              if (compare(originalPixel, pixel)) {
                color(pixel);
                ctx.putImageData(pixel, x, y);
              } else {
                y = 0;
              }
            }
            for (let y = clickY + 1; y < 600; y++) {
              const pixel = ctx.getImageData(x, y, 1, 1);
              if (compare(originalPixel, pixel)) {
                color(pixel);
                ctx.putImageData(pixel, x, y);
              } else {
                y = 600;
              }
            }
          } else {
            x = 400;
          }
        }
      }

      canvas.addEventListener("click", function (event) {
        pick(event);
      });
    </script>
  </body>
</html>
